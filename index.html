<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Meme Social</title>
  <link rel="icon" href="favicon.ico" />
  <style>
body {
  margin: 0;
  font-family: 'Inter', Arial, sans-serif;
  background: linear-gradient(135deg, #e2e2e2 0%, #f5f5f5 100%);
  min-height: 100vh;
}
.navbar {
  width: 100vw;
  max-width: 100%;
  background: #2d72ff;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.2rem 2.5rem;
  font-size: 1.4rem;
  font-weight: 700;
  border-radius: 0 0 2rem 2rem;
  box-shadow: 0 5px 24px rgba(0,0,0,0.08);
  margin-bottom: 2rem;
}
.navbar__title {
  font-size: 1.4rem;
  font-weight: bold;
}
.navbar__logout {
  background: #fff;
  color: #2d72ff;
  border: none;
  border-radius: 0.8rem;
  padding: 0.4rem 1.2rem;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
}
.container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  align-items: center;
  justify-content: flex-start;
  padding-top: 40px;
}
.card {
  background: #fff;
  box-shadow: 0 4px 24px rgba(0,0,0,0.08);
  border-radius: 1.5rem;
  padding: 2.5rem;
  min-width: 350px;
  margin-bottom: 2rem;
  width: 100%;
  max-width: 500px;
}
.input {
  padding: 0.8rem;
  border: 1px solid #d0d0d0;
  border-radius: 0.6rem;
  font-size: 1rem;
  margin-bottom: 1rem;
  width: 100%;
  box-sizing: border-box;
}
.btn {
  background: #2d72ff;
  color: #fff;
  border: none;
  border-radius: 0.6rem;
  padding: 0.8rem;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  margin-bottom: 1rem;
  transition: background 0.2s;
  width: 100%;
}
.btn--primary:hover {
  background: #1a50b6;
}
.error {
  color: #e53e3e;
  margin-top: 0.5rem;
  font-size: 0.98rem;
}
.meme-create {
  margin-bottom: 2.5rem;
}
.meme-preview {
  margin: 1rem 0;
  width: 100%;
  border-radius: 1rem;
  box-shadow: 0 2px 10px rgba(0,0,0,0.06);
}
.meme-feed {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  margin-bottom: 1.5rem;
}
.meme-card {
  background: #f9f9f9;
  border-radius: 1rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  padding: 1.2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.meme-card img {
  width: 100%;
  max-width: 340px;
  border-radius: 0.7rem;
  margin-bottom: 0.7rem;
}
.meme-card .caption {
  font-size: 1.1rem;
  font-weight: 500;
  margin-bottom: 0.2rem;
}
.meme-card .prompt {
  font-size: 0.95rem;
  color: #666;
}
.feed-empty {
  text-align: center;
  color: #888;
  font-size: 1.1rem;
  margin: 2.5rem 0;
}
@media (max-width: 600px) {
  .card {
    min-width: unset;
    padding: 1rem;
  }
  .navbar {
    padding: 1rem;
    font-size: 1.1rem;
  }
}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
</head>
<body>
  <nav class="navbar">
    <div class="navbar__title">Meme Social</div>
    <button class="navbar__logout" id="logoutBtn" style="display:none;">Logout</button>
  </nav>
  <div class="container">
    <div class="card" id="authCard">
      <h2>Meme Social</h2>
      <form id="authForm">
        <input type="email" placeholder="Email" id="email" required class="input" />
        <input type="password" placeholder="Password" id="password" required class="input" />
        <button type="submit" class="btn btn--primary" id="authBtn">Login</button>
        <div>
          <a href="#" id="toggleAuth">Don't have an account? Register</a>
        </div>
        <div id="authError" class="error"></div>
      </form>
    </div>
    <div class="card" id="appCard" style="display:none;">
      <section class="meme-create">
        <h3>Generate a Meme with AI</h3>
        <input type="text" id="prompt" placeholder="Describe your meme idea" class="input" />
        <button class="btn btn--primary" id="generateBtn">Generate with AI</button>
        <div id="memePreview" style="display:none;">
          <img id="memeImage" class="meme-preview" alt="Generated Meme" />
          <input type="text" id="caption" placeholder="Add a caption (optional)" class="input" />
          <button class="btn btn--primary" id="postBtn">Post Meme</button>
        </div>
        <div id="generateError" class="error"></div>
      </section>
      <section>
        <h3>Latest Memes</h3>
        <div id="feedEmpty" class="feed-empty">No memes yet! Be the first to create one.</div>
        <div class="meme-feed" id="memeFeed"></div>
      </section>
    </div>
  </div>
  <script>
/* ==== CONFIGURATION ==== */
const APPWRITE_ENDPOINT = "https://fra.cloud.appwrite.io/v1"; // Change as needed
const APPWRITE_PROJECT = "YOUR_PROJECT_ID"; // Replace!
const APPWRITE_DATABASE = "YOUR_DATABASE_ID"; // Replace!
const APPWRITE_COLLECTION = "YOUR_COLLECTION_ID"; // Replace!

/* ==== INIT APPWRITE ==== */
const client = new window.appwrite.Client();
client.setEndpoint(APPWRITE_ENDPOINT).setProject(APPWRITE_PROJECT);
const account = new window.appwrite.Account(client);
const databases = new window.appwrite.Databases(client);
const ID = window.appwrite.ID;
const Permission = window.appwrite.Permission;
const Role = window.appwrite.Role;

/* ==== UI ELEMENTS ==== */
const authCard = document.getElementById('authCard');
const appCard = document.getElementById('appCard');
const authForm = document.getElementById('authForm');
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const authBtn = document.getElementById('authBtn');
const toggleAuth = document.getElementById('toggleAuth');
const authError = document.getElementById('authError');
const logoutBtn = document.getElementById('logoutBtn');

const promptInput = document.getElementById('prompt');
const generateBtn = document.getElementById('generateBtn');
const memePreview = document.getElementById('memePreview');
const memeImage = document.getElementById('memeImage');
const captionInput = document.getElementById('caption');
const postBtn = document.getElementById('postBtn');
const generateError = document.getElementById('generateError');
const memeFeed = document.getElementById('memeFeed');
const feedEmpty = document.getElementById('feedEmpty');

/* ==== APP STATE ==== */
let isRegister = false;
let user = null;
let currentMemeImageUrl = "";

/* ==== AUTH HANDLING ==== */
async function checkSession() {
  try {
    user = await account.get();
    showApp();
  } catch {
    showAuth();
  }
}

function showApp() {
  authCard.style.display = "none";
  appCard.style.display = "block";
  logoutBtn.style.display = "inline-block";
  fetchMemes();
}

function showAuth() {
  authCard.style.display = "block";
  appCard.style.display = "none";
  logoutBtn.style.display = "none";
  authForm.reset();
  authBtn.textContent = "Login";
  isRegister = false;
  toggleAuth.textContent = "Don't have an account? Register";
}

toggleAuth.addEventListener("click", (e) => {
  e.preventDefault();
  isRegister = !isRegister;
  authBtn.textContent = isRegister ? "Register" : "Login";
  toggleAuth.textContent = isRegister ? "Already have an account? Sign in" : "Don't have an account? Register";
  authError.textContent = "";
});

authForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  authError.textContent = "";
  try {
    if (isRegister) {
      await account.create('unique()', emailInput.value, passwordInput.value);
    }
    await account.createEmailSession(emailInput.value, passwordInput.value);
    user = await account.get();
    showApp();
  } catch (err) {
    authError.textContent = err.message || "Authentication failed";
  }
});

logoutBtn.addEventListener("click", async () => {
  await account.deleteSession("current");
  user = null;
  showAuth();
});

/* ==== MEME CREATION ==== */
generateBtn.addEventListener("click", async () => {
  const prompt = promptInput.value.trim();
  if (!prompt) return;
  generateError.textContent = "";
  generateBtn.disabled = true;
  generateBtn.textContent = "Generating...";
  memePreview.style.display = "none";
  try {
    const aiImageUrl = await generateMemeWithAI(prompt);
    currentMemeImageUrl = aiImageUrl;
    memeImage.src = aiImageUrl;
    memePreview.style.display = "block";
  } catch {
    generateError.textContent = "Failed to generate meme. Try a different prompt!";
  }
  generateBtn.disabled = false;
  generateBtn.textContent = "Generate with AI";
});

postBtn.addEventListener("click", async () => {
  if (!currentMemeImageUrl) return;
  postBtn.disabled = true;
  postBtn.textContent = "Posting...";
  try {
    await databases.createDocument(
      APPWRITE_DATABASE,
      APPWRITE_COLLECTION,
      ID.unique(),
      {
        image: currentMemeImageUrl,
        caption: captionInput.value,
        prompt: promptInput.value
      },
      [
        Permission.read(Role.any()),
        Permission.write(Role.user(user.$id)),
        Permission.create(Role.user("any"))
      ]
    );
    // Reset
    memePreview.style.display = "none";
    promptInput.value = "";
    captionInput.value = "";
    currentMemeImageUrl = "";
    fetchMemes();
  } catch {
    generateError.textContent = "Failed to post meme.";
  }
  postBtn.disabled = false;
  postBtn.textContent = "Post Meme";
});

/* ==== FEED ==== */
async function fetchMemes() {
  memeFeed.innerHTML = "";
  feedEmpty.style.display = "block";
  try {
    const docs = await databases.listDocuments(
      APPWRITE_DATABASE,
      APPWRITE_COLLECTION,
      ['orderDesc($createdAt)']
    );
    if (docs.documents.length === 0) return;
    feedEmpty.style.display = "none";
    docs.documents.forEach(meme => {
      const card = document.createElement("div");
      card.className = "meme-card";
      if (meme.image) {
        const img = document.createElement("img");
        img.src = meme.image;
        img.alt = "Meme";
        card.appendChild(img);
      }
      const cap = document.createElement("div");
      cap.className = "caption";
      cap.textContent = meme.caption || "";
      card.appendChild(cap);
      const prompt = document.createElement("div");
      prompt.className = "prompt";
      prompt.textContent = meme.prompt ? `Prompt: ${meme.prompt}` : "";
      card.appendChild(prompt);
      memeFeed.appendChild(card);
    });
  } catch {
    feedEmpty.textContent = "Failed to load memes.";
  }
}

/* ==== AI MEME GENERATION ==== */
async function generateMemeWithAI(prompt) {
  // Call your backend endpoint for AI image generation (must be deployed separately)
  const resp = await fetch('/api/generate-meme', {
    method: 'POST',
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ prompt })
  });
  if (!resp.ok) throw new Error("AI image generation failed");
  const data = await resp.json();
  return data.url;
}

/* ==== ON LOAD ==== */
window.addEventListener("DOMContentLoaded", () => {
  checkSession();
});
  </script>
</body>
</html>
